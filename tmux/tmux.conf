# tmux Configuration - Vesper Theme
# Ghostty as renderer, tmux as window manager

# ===========================
# Prefix Key
# ===========================
# Ghostty translates cmd+shift+space to ctrl+space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# ===========================
# General Settings
# ===========================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Allow cursor shape passthrough for vim mode
set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# Allow passthrough for image.nvim
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 100000
set -g escape-time 0
set -g focus-events on
set -g set-clipboard on

# ===========================
# Vi Mode
# ===========================
setw -g mode-keys vi
set -g status-keys vi

# ===========================
# Copy Mode (vim-style)
# ===========================
bind v copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi H send -X start-of-line
bind -T copy-mode-vi L send -X end-of-line

# ===========================
# Pane Navigation (vim-style)
# ===========================
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ===========================
# Pane Splitting
# ===========================
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# ===========================
# Pane Resizing
# ===========================
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ===========================
# Window Navigation
# ===========================
bind -r C-h previous-window
bind -r C-l next-window
bind c new-window -c "#{pane_current_path}"

# ===========================
# Session Management
# ===========================
bind S command-prompt -p "New session:" "new-session -s '%%'"
bind s choose-tree -sZ

# ===========================
# Quick Actions
# ===========================
bind r source-file ~/.tmux.conf \; display "Config reloaded"
bind x kill-pane
bind X kill-window
bind q confirm-before -p "Kill session? (y/n)" kill-session

# ===========================
# Vesper Theme - Status Bar
# ===========================
set -g status off
set -g status-position top
set -g status-justify centre
set -g status-style "bg=#101010,fg=#a0a0a0"

# Left: prefix indicator
set -g status-left-length 20
set -g status-left "#{prefix_highlight}"

# Right: plugins
set -g status-right-length 60
set -g status-right "#{online_status} #[fg=#ffc799]#{battery_icon}#{battery_percentage} #[fg=#65737e]| #[fg=#99ffe4]cpu:#{cpu_percentage}"

# Window tabs - dots as indicators
setw -g window-status-format "#[fg=#505050] ○ #W "
setw -g window-status-current-format "#[fg=#ffc799] ● #W "
setw -g window-status-separator ""

# Toggle status bar with prefix + b
bind b set -g status

# ===========================
# Pane Borders - Vesper
# ===========================
set -g pane-border-style "fg=#2a2a2a"
set -g pane-active-border-style "fg=#ffc799"

# ===========================
# Message Style
# ===========================
set -g message-style "bg=#ffc799,fg=#101010,bold"
set -g message-command-style "bg=#101010,fg=#ffc799"

# ===========================
# Copy Mode Highlight
# ===========================
setw -g mode-style "bg=#2a2a2a,fg=#ffffff"

# ===========================
# Plugins (TPM)
# ===========================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-online-status'

# Prefix highlight
set -g @prefix_highlight_fg '#101010'
set -g @prefix_highlight_bg '#ffc799'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=#101010,bg=#80d9c7'

# Battery - nerd font icons
set -g @batt_icon_charge_tier8 '█'
set -g @batt_icon_charge_tier7 '▇'
set -g @batt_icon_charge_tier6 '▆'
set -g @batt_icon_charge_tier5 '▅'
set -g @batt_icon_charge_tier4 '▄'
set -g @batt_icon_charge_tier3 '▃'
set -g @batt_icon_charge_tier2 '▂'
set -g @batt_icon_charge_tier1 '▁'
set -g @batt_icon_status_charged '='
set -g @batt_icon_status_charging '+'

# Online status
set -g @online_icon "#[fg=#80d9c7]on"
set -g @offline_icon "#[fg=#ff8080]off"


# Initialize TPM (keep at bottom)
run '~/.tmux/plugins/tpm/tpm'
